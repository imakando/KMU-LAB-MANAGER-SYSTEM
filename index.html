<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>University Lab — Admin & Supervisor Console</title>

  <!-- Neon / Cyber style (simple embedded CSS) -->
  <style>
    :root{
      --bg:#0b0f1a;
      --panel:#071026;
      --neon-blue: #00d3ff;
      --neon-green:#6fff6f;
      --neon-yellow:#ffd24a;
      --neon-pink:#ff4ecf;
      --glass: rgba(255,255,255,0.03);
      --accent: linear-gradient(90deg,var(--neon-blue),var(--neon-pink));
      --soft-shadow: 0 6px 24px rgba(0,0,0,0.6);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    html,body{height:100%;margin:0;background:radial-gradient(ellipse at top left,#071728 0%, var(--bg) 60%); color:#cfeefc;}
    .app {
      max-width:1200px;margin:24px auto;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01)); box-shadow: var(--soft-shadow);
      border: 1px solid rgba(255,255,255,0.03);
      backdrop-filter: blur(6px);
    }
    header{display:flex;align-items:center;gap:16px;padding-bottom:12px;border-bottom:1px solid rgba(255,255,255,0.02)}
    .logo {font-weight:700;font-size:1.2rem;color:var(--neon-blue);text-shadow:0 0 8px rgba(0,211,255,0.28)}
    .sys-health{margin-left:auto;display:flex;align-items:center;gap:8px}
    .neon-pill{padding:6px 10px;border-radius:999px;background:linear-gradient(90deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
    .neon-text{color:var(--neon-green);text-shadow:0 0 10px rgba(111,255,111,0.12)}
    .controls{display:flex;gap:8px}
    button{cursor:pointer;border-radius:10px;padding:8px 12px;border:none;font-weight:600}
    .btn-primary{background:var(--neon-blue);color:#001;box-shadow:0 6px 18px rgba(0,211,255,0.08);text-shadow:0 0 6px rgba(0,211,255,0.06)}
    .btn-success{background:var(--neon-green);color:#002}
    .btn-warning{background:var(--neon-yellow);color:#081}
    .btn-danger{background:#ff6b6b;color:#2b0000}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02)); padding:14px;border-radius:12px;margin-top:12px;border:1px solid rgba(255,255,255,0.03)}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .cols-2{display:grid;grid-template-columns:2fr 1fr;gap:12px}
    .station-card{padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.012), rgba(255,255,255,0.01)); border:1px solid rgba(255,255,255,0.02)}
    input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:8px;color:#cfeefc;width:100%}
    .muted{color:#8fb3c7;font-size:0.9rem}
    .title-neon{color:var(--neon-yellow);font-weight:800;text-shadow:0 0 12px rgba(255,210,74,0.12)}
    .chat-box{max-height:240px;overflow:auto;padding:8px;background:rgba(0,0,0,0.35);border-radius:8px}
    .chat-item{margin-bottom:8px;padding:6px;border-radius:8px;background:linear-gradient(90deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02))}
    .small{font-size:0.85rem}
    .floating-action{position:fixed;right:28px;bottom:28px;z-index:999}
    .glow{box-shadow:0 0 18px rgba(0,211,255,0.08), inset 0 1px 0 rgba(255,255,255,0.02)}
    .hidden{display:none}
    .badge{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.02);color:var(--neon-blue);font-weight:700}
    /* animations */
    .fade-in { animation: fadeIn .35s ease both; }
    @keyframes fadeIn { from { opacity:0; transform: translateY(6px);} to {opacity:1; transform:none;} }
    .blinking-dot { width:10px;height:10px;border-radius:50%;background:var(--neon-pink);display:inline-block;box-shadow:0 0 8px rgba(255,78,207,0.5);animation:blink 1.2s infinite; }
    @keyframes blink { 50%{opacity:0.2} }
    footer{margin-top:18px;text-align:center;color:#7fb0c6;font-size:0.9rem}
    /* responsive */
    @media (max-width:980px){.grid-3{grid-template-columns:1fr}.cols-2{grid-template-columns:1fr}}
  </style>

  <!-- Icons & libs -->
  <script src="https://unpkg.com/lucide@latest" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/docx@8.0.1/build/index.umd.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js" defer></script>
</head>
<body>
  <div class="app fade-in" id="appRoot">

    <header>
      <div class="logo">UNI LAB • Station Management</div>
      <div class="muted">Cyber Bright — Neon Control Console</div>

      <div class="sys-health neon-pill">
        <strong class="muted">SYSTEM HEALTH:</strong>
        <span id="healthStatus" class="badge">Checking...</span>
      </div>

      <div class="controls" style="margin-left:12px">
        <button id="themeToggle" class="btn-warning">Toggle Theme</button>
        <button id="showAdminBtn" class="btn-primary">Admin Login</button>
        <button id="showSupBtn" class="btn-success">Supervisor Login</button>
      </div>
    </header>

    <!-- LOGIN PANEL -->
    <div class="panel" id="loginPanel" style="margin-top:12px">
      <h2 class="title-neon">ACCESS TERMINAL</h2>
      <p class="muted">Select your role and sign in using university account credentials.</p>

      <div style="display:flex;gap:12px;margin-top:8px">
        <div style="flex:1">
          <h3 class="muted">Admin</h3>
          <form id="adminLoginForm">
            <input id="adminEmail" placeholder="Admin email" type="email" required />
            <input id="adminPass" placeholder="Password" type="password" required style="margin-top:8px"/>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn-primary" type="submit">Admin Login</button>
              <button id="adminCreateBtn" class="btn-warning" type="button">Create Test Admin</button>
            </div>
          </form>
        </div>

        <div style="flex:1">
          <h3 class="muted">Supervisor</h3>
          <form id="supLoginForm">
            <input id="supEmail" placeholder="Supervisor email" type="email" required />
            <input id="supPass" placeholder="Password" type="password" required style="margin-top:8px"/>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button class="btn-success" type="submit">Supervisor Login</button>
              <button id="supCreateBtn" class="btn-warning" type="button">Create Test Supervisor</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- MAIN: Admin & Supervisor dashboards -->
    <div id="adminDashboard" class="hidden">
      <div class="panel">
        <div style="display:flex;align-items:center;gap:12px">
          <h2 class="title-neon">ADMIN DASHBOARD</h2>
          <div class="muted" id="adminNameDisplay"></div>
          <div style="margin-left:auto;display:flex;gap:8px">
            <button id="adminLogout" class="btn-danger">Logout</button>
            <button id="openSettings" class="btn-primary">System Settings</button>
          </div>
        </div>

        <!-- Admin quick actions -->
        <div style="margin-top:12px" class="grid-3">
          <div class="panel">
            <h4 class="muted">Global Station View</h4>
            <input id="adminStationSearch" placeholder="Search station or student..." />
            <div id="stationsGridAdmin" style="margin-top:10px;max-height:260px;overflow:auto"></div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="createStationBtn" class="btn-primary">Create Station</button>
              <button id="bulkOfflineBtn" class="btn-warning">Set Bulk Offline</button>
            </div>
          </div>

          <div class="panel">
            <h4 class="muted">Activity & Reports</h4>
            <div style="max-height:200px;overflow:auto" id="auditListAdmin"></div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="exportPdfBtn" class="btn-primary">Export Audit PDF</button>
              <button id="exportDocxBtn" class="btn-warning">Export Word</button>
            </div>
          </div>

          <div class="panel">
            <h4 class="muted">Analytics</h4>
            <canvas id="chartAssignments" style="width:100%;height:160px"></canvas>
            <canvas id="chartPeak" style="width:100%;height:120px;margin-top:8px"></canvas>
          </div>
        </div>

        <!-- Admin user & lab management -->
        <div style="display:flex;gap:12px;margin-top:12px">
          <div style="flex:1" class="panel">
            <h4 class="muted">User Management</h4>
            <div style="display:flex;gap:8px">
              <input id="newUserEmail" placeholder="email" />
              <select id="newUserRole"><option value="admin">Admin</option><option value="supervisor">Supervisor</option></select>
              <button id="createUserBtn" class="btn-primary">Create</button>
            </div>
            <div id="userListAdmin" style="margin-top:10px;max-height:180px;overflow:auto"></div>
          </div>
          <div style="width:380px" class="panel">
            <h4 class="muted">Maintenance Tickets</h4>
            <div id="ticketListAdmin" style="max-height:220px;overflow:auto"></div>
            <div style="display:flex;gap:8px;margin-top:8px">
              <button id="assignTicketBtn" class="btn-primary">Assign Technician</button>
              <button id="closeTicketBtn" class="btn-success">Close Ticket</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="supervisorDashboard" class="hidden">
      <div class="panel">
        <div style="display:flex;align-items:center;gap:12px">
          <h2 class="title-neon">SUPERVISOR DASHBOARD</h2>
          <div class="muted" id="supNameDisplay"></div>
          <div style="margin-left:auto;display:flex;gap:8px">
            <button id="supLogout" class="btn-danger">Logout</button>
          </div>
        </div>

        <div style="margin-top:12px" class="cols-2">
          <div>
            <!-- Kiosk / Assign -->
            <div class="panel">
              <h4 class="muted">Kiosk Lock & Assignment</h4>
              <form id="studentLookupForm">
                <input id="studentIdLookup" placeholder="Student ID e.g., UMB12345" required />
                <div style="display:flex;gap:8px;margin-top:8px">
                  <button class="btn-success" type="submit">Fetch</button>
                  <button id="scanQrBtn" type="button" class="btn-primary">Scan QR (simulate)</button>
                </div>
              </form>

              <div id="studentCard" class="hidden" style="margin-top:12px">
                <div class="panel">
                  <div><strong id="stName"></strong> <span class="muted" id="stProgram"></span></div>
                  <div class="muted small">ID: <span id="stIdView"></span> • Year: <span id="stYear"></span></div>
                  <div style="margin-top:8px">
                    <label class="muted">Select Station</label>
                    <select id="availableStations"></select>
                    <div style="display:flex;gap:8px;margin-top:8px">
                      <button id="assignStationBtn" class="btn-primary">Assign & Generate Key</button>
                      <button id="reserveStationBtn" class="btn-warning">Reserve For Exam</button>
                      <button id="extendSessionBtn" class="btn-success">Extend Session</button>
                    </div>
                    <div style="margin-top:8px">
                      <small class="muted">Session Key:</small> <strong id="sessionKeyView" class="neon-text"></strong>
                      <div id="assignmentMessage" class="muted small"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Active Stations & Quick Actions -->
            <div class="panel" style="margin-top:12px">
              <h4 class="muted">Active Stations</h4>
              <div id="activeStationsList" style="max-height:220px;overflow:auto"></div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <button id="forceReleaseBtn" class="btn-primary">Force Release</button>
                <button id="reportMaintBtn" class="btn-warning">Report Maintenance</button>
                <button id="autoAssignBtn" class="btn-success">Auto-Assign Queue</button>
              </div>
            </div>

            <!-- Chat -->
            <div class="panel" style="margin-top:12px">
              <h4 class="muted">Chat with Admin</h4>
              <div id="supChatBox" class="chat-box"></div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <input id="supChatInput" placeholder="Message..." />
                <button id="supSendBtn" class="btn-success">Send</button>
              </div>
            </div>
          </div>

          <div>
            <!-- Supervisor Tools -->
            <div class="panel">
              <h4 class="muted">Supervisor Tools</h4>
              <div style="display:flex;gap:8px;margin-bottom:8px">
                <button id="viewHistoryBtn" class="btn-primary">View Assignment History</button>
                <button id="lateAlertsBtn" class="btn-warning">Late Sessions</button>
                <button id="heartbeatBtn" class="btn-success">Check Heartbeats</button>
              </div>

              <div style="margin-top:8px">
                <h5 class="muted">Station Health</h5>
                <div id="stationHealthList" style="max-height:220px;overflow:auto"></div>
              </div>
            </div>

            <div class="panel" style="margin-top:12px">
              <h4 class="muted">Reports & Export</h4>
              <div style="display:flex;gap:8px">
                <button id="supExportPdf" class="btn-primary">Export Report PDF</button>
                <button id="supExportCsv" class="btn-warning">Export CSV</button>
              </div>
              <h5 style="margin-top:8px" class="muted">Quick Stats</h5>
              <div id="supQuickStats"></div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div id="toast" style="display:none;position:fixed;left:50%;transform:translateX(-50%);bottom:16px;background:#001827;padding:10px;border-radius:8px;color:#bff;z-index:999"></div>

    <footer>Built for university labs • Real Firestore-backed • Neon Cyber UI</footer>
  </div>

  <!-- App script (module) -->
  <script type="module" src="./app.js"></script>
</body>
</html>
